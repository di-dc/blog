<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[danisaacs.net]]></title><description><![CDATA[Things I want to remember]]></description><link>https://blog.danisaacs.net/</link><image><url>https://blog.danisaacs.net/favicon.png</url><title>danisaacs.net</title><link>https://blog.danisaacs.net/</link></image><generator>Ghost 4.36</generator><lastBuildDate>Sat, 05 Mar 2022 15:55:54 GMT</lastBuildDate><atom:link href="https://blog.danisaacs.net/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[Guess who's back? Alloy's back!]]></title><description><![CDATA[<h2 id="alloy-on-cms-12">Alloy! On CMS 12!</h2><p>If you&apos;ve worked with Optimizely Content Cloud for awhile, two things are probably true:</p><ol><li>You still sometimes call it Episerver CMS (and if it&apos;s been a longer while, you write it as EPiServer CMS)</li><li>You&apos;ve seen the Alloy demo site</li></ol>]]></description><link>https://blog.danisaacs.net/guess-whos-back-alloys-back/</link><guid isPermaLink="false">622382367ea3e100011d57d9</guid><dc:creator><![CDATA[Dan Isaacs]]></dc:creator><pubDate>Sat, 05 Mar 2022 15:48:34 GMT</pubDate><media:content url="https://blog.danisaacs.net/content/images/2022/03/alloy-cms-12-1.png" medium="image"/><content:encoded><![CDATA[<h2 id="alloy-on-cms-12">Alloy! On CMS 12!</h2><img src="https://blog.danisaacs.net/content/images/2022/03/alloy-cms-12-1.png" alt="Guess who&apos;s back? Alloy&apos;s back!"><p>If you&apos;ve worked with Optimizely Content Cloud for awhile, two things are probably true:</p><ol><li>You still sometimes call it Episerver CMS (and if it&apos;s been a longer while, you write it as EPiServer CMS)</li><li>You&apos;ve seen the Alloy demo site</li></ol><p>Until recently with CMS 12, starting a new site meant either an empty site, or a <a href="https://blog.danisaacs.net/running-with-foundation/">Foundation site</a>. However, last Friday, Optimizely quietly released a CMS12 version of the Alloy sample site.</p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/03/alloy-cms-12.png" class="kg-image" alt="Guess who&apos;s back? Alloy&apos;s back!" loading="lazy" width="858" height="657" srcset="https://blog.danisaacs.net/content/images/size/w600/2022/03/alloy-cms-12.png 600w, https://blog.danisaacs.net/content/images/2022/03/alloy-cms-12.png 858w" sizes="(min-width: 720px) 720px"></figure><p>Want to get your own CMS12 Alloy site running locally? Follow the steps below!</p><h2 id="prereqs">Prereqs</h2><p>.NET SDK 5+ SQL Server 2016 Express LocalDB (or later)</p><h2 id="setup">Setup</h2><p>First, set up your development environment -- install the Episerver Templates and the Episerver CLI Tool.<br><br>Note: if it&#x2019;s been awhile since you installed the CLI Tool, it might be worthwhile to make sure you&#x2019;re on the latest version:</p><!--kg-card-begin: markdown--><pre><code>dotnet tool update EPiServer.Net.Cli --global --add-source https://nuget.optimizely.com/feed/packages.svc/
</code></pre>
<!--kg-card-end: markdown--><p>Install the Alloy templates: in your command-line of choice, run the following command to install the template package (you can <a href="https://www.nuget.org/packages/EPiServer.Templates/">look up the latest version number here</a>):</p><!--kg-card-begin: markdown--><pre><code>dotnet new --install EPiServer.Templates::1.0.0
</code></pre>
<!--kg-card-end: markdown--><p>Create your project folder, and change to that directory:</p><!--kg-card-begin: markdown--><pre><code>mkdir projectname

cd projectname
</code></pre>
<!--kg-card-end: markdown--><p>Create a new CMS 12 site with the Alloy MVC templates included:</p><!--kg-card-begin: markdown--><pre><code>dotnet new epi-alloy-mvc --name projectName
</code></pre>
<!--kg-card-end: markdown--><p>Create a new, empty database:</p><!--kg-card-begin: markdown--><pre><code>dotnet-episerver create-cms-database ProjectName.csproj -S . -E
</code></pre>
<!--kg-card-end: markdown--><p>At this point, you have everything you need to run the site.<br><br>Build the site (technically, this step can be skipped, because the <em><em>run</em></em> command will trigger a build if needed, but I prefer to do the build separately -- easier to identify issues):</p><!--kg-card-begin: markdown--><pre><code>dotnet build
</code></pre>
<!--kg-card-end: markdown--><p>Finally, run the site:</p><!--kg-card-begin: markdown--><pre><code>dotnet run
</code></pre>
<!--kg-card-end: markdown--><p>If there are no errors in the console, the site should now be up, and can be accessed in your web browser at: <a href="https://localhost:5000/">https://localhost:5000/</a><br><br>Note: want to change the port, or run on http instead of https? Before running the site, update the &#x201C;<em>applicationUrl</em>&#x201D; property in the file <em><em>projectName\Properties\launchSettings.json</em></em> .<br><br>The first time you access the site, it should prompt you to create an admin user.</p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/03/create-admin-account.png" class="kg-image" alt="Guess who&apos;s back? Alloy&apos;s back!" loading="lazy" width="529" height="564"></figure><p>Once the site loads, there&apos;s a login link in the bottom-right of the footer -- or just append the path &quot;/episerver/cms&quot; to the URL to get to the login page. That will bring you to the CMS. First time in CMS 12? You&apos;ll find it largely looks the same, but everything is quite a bit snappier. You&apos;ll love it.</p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/03/alloy-cms-12-backend.png" class="kg-image" alt="Guess who&apos;s back? Alloy&apos;s back!" loading="lazy" width="1619" height="795" srcset="https://blog.danisaacs.net/content/images/size/w600/2022/03/alloy-cms-12-backend.png 600w, https://blog.danisaacs.net/content/images/size/w1000/2022/03/alloy-cms-12-backend.png 1000w, https://blog.danisaacs.net/content/images/size/w1600/2022/03/alloy-cms-12-backend.png 1600w, https://blog.danisaacs.net/content/images/2022/03/alloy-cms-12-backend.png 1619w" sizes="(min-width: 720px) 720px"></figure><h2 id="troubleshooting">Troubleshooting</h2><p>If the dotnet run command fails with an error about creating the database (&#x201C;<em>Cannot attach the file &apos;&#x2026;\projectName\App_Data\alloy_cms12.mdf&apos; as database &apos;alloy_cms12&apos;.</em>&#x201D;) &#x2013; you may need to change the permissions on your AppData folder. (I just added &quot;Modify&quot; rights to Users -- right click the folder &gt; Properties &gt; Security &gt; click Edit &gt; select Users &gt; check &quot;Modify&quot;. Then apply the changes.)</p><h2 id="additional-options">Additional options</h2><ul><li>Not on Windows? It also supports Docker. (I haven&apos;t tried it yet, my laptop can&apos;t handle Docker.)</li><li>Want to set the database SA password? Use the &quot;--sa-password&quot; option.</li></ul><p>More info on those options can be found via the help command, or by checking out the <a href="https://github.com/episerver/content-templates/tree/develop/templates/Alloy.Mvc">project readme</a>:</p><!--kg-card-begin: markdown--><pre><code>PS F:\code\_TESTING&gt; dotnet new epi-alloy-mvc --help
Optimizely Alloy MVC (C#)
Author: Episerver AB
Description: Example MVC application for testing and learning Optimizely CMS.
Options:
  --enable-docker  Enable Docker support
                   bool - Optional
                   Default: false

  --sa-password    The password the SA database account should have
                   string - Optional
                   Default: Qwerty12345!
</code></pre>
<!--kg-card-end: markdown--><p>Thanks for reading, and enjoy Alloy on CMS12!</p><h2 id="resources">Resources</h2><ul><li>The templates can be found here: <a href="https://github.com/episerver/content-templates">https://github.com/episerver/content-templates</a></li><li>The template (nuget) package can be found here: <a href="https://www.nuget.org/packages/EPiServer.Templates/">https://www.nuget.org/packages/EPiServer.Templates/</a></li></ul>]]></content:encoded></item><item><title><![CDATA[Running with Foundation]]></title><description><![CDATA[Getting started with Foundation, the Optimizely reference site.]]></description><link>https://blog.danisaacs.net/running-with-foundation/</link><guid isPermaLink="false">620d9db7b71c9400018985a9</guid><category><![CDATA[optimizely]]></category><category><![CDATA[foundation]]></category><dc:creator><![CDATA[Dan Isaacs]]></dc:creator><pubDate>Thu, 17 Feb 2022 02:51:25 GMT</pubDate><media:content url="https://blog.danisaacs.net/content/images/2022/02/foundation.png" medium="image"/><content:encoded><![CDATA[<img src="https://blog.danisaacs.net/content/images/2022/02/foundation.png" alt="Running with Foundation"><p>If you&apos;re reading this, you&apos;ve probably already heard of Foundation, our <a href="https://www.optimizely.com/">Optimizely</a> &#xA0;(formerly Episerver) Content Cloud + B2C Commerce Cloud reference site. Want to run a local instance for testing or evaluation purposes? Want to use it as a starter site for a build? No problem &#x2013; it&apos;s freely available up in GitHub: <a href="https://github.com/episerver/Foundation">https://github.com/episerver/Foundation</a>. Below I&apos;m going to walk through a few tips + tricks on getting it running, but first two important callouts: </p><ol><li>Use the latest &amp; greatest! This article is focused on the CMS 12 / Commerce 14 version, running on .NET 5. If you want to use the earlier version, you can still follow the setup steps detailed in the readme on the (at the time of this writing) <em>master </em>branch. (But really, that&apos;d be a mistake &#x2013; .NET 5 is the way to go.)</li><li>I&apos;m focused here on the full version of Foundation &#x2013; there&apos;s also a <a href="https://github.com/episerver/foundation-mvc-cms">CMS-only version</a> if that&apos;s more your bag. (I think most of the instructions below should apply to that one, but I make no promises!)</li></ol><h3 id="getting-ready">Getting ready</h3><p>As noted above, the repository is at: <a href="https://github.com/episerver/Foundation">https://github.com/episerver/Foundation</a> &#x2013; for .NET5 (at least at the moment) you&apos;ll want to be working with the <a href="https://github.com/episerver/Foundation/tree/main"><em>main</em> branch</a>.</p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/02/foundation-select-main-branch-e.png" class="kg-image" alt="Running with Foundation" loading="lazy" width="231" height="312"></figure><p>Take a look at the readme to see the system requirements. On Windows, make you&apos;ll want SQL Server, Node.JS, and .NET5 runtime. (And some other stuff for running under IIS, but I&apos;ll cover that below.) For Mac/Linux (we can run on Mac and Linux now! Exciting!), the setup requires Docker (for SQL Server). You could approach that in other ways, but it&apos;s not built in to the setup script.</p><h3 id="running-locally">Running locally</h3><p>If you just want to run things locally (for example, for dev or for evaluation purposes), setup is a breeze. Just follow the instructions in the readme for your system type. </p><p>The only pro-tip I&apos;d throw in here is to update your <em>appsettings.json</em> file with a valid Optimizely Search &amp; Navigation (AKA Optimizely Find (AKA Episerver Find)) index before running the solution. Don&apos;t have an index? Sign up at <a href="https://find.episerver.com">https://find.episerver.com</a> and generate a free dev index, and then add the index and service URL details:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.danisaacs.net/content/images/2022/02/find.png" class="kg-image" alt="Running with Foundation" loading="lazy" width="446" height="103"><figcaption>changeme!</figcaption></figure><p>Then, execute the <em>dotnet run...</em> command, wait until new warnings stop being shown, and then pull up your browser and hit <em>http://localhost:5000</em>. (If it doesn&apos;t load or you get a &quot;connection refused&quot; message, try again in 30 seconds. The first time up can take a minute or two or three, as it does some initialization steps and content imports.)</p><p>To stop the site, press Ctrl-C in your Powershell window (you may need to hit it a few times, if your laptop&apos;s like mine).</p><h3 id="graduating-to-iis">Graduating to IIS</h3><p>Ready to step it up, and run under IIS? It&apos;s not all that different, but there are a few gotchas to be aware of.</p><p>Note: this is not intended to be an in-depth tutorial on all details of IIS setup. For a deeper dive into creating an IIS site for Optimizely CMS running on .NET 5, a more detailed write-up can be found here: <u><a href="https://www.jondjones.com/learn-optimizely/cms/how-to-install-optimizely-cms-12-and-configure-a-development-environment/">https://www.jondjones.com/learn-optimizely/cms/how-to-install-optimizely-cms-12-and-configure-a-development-environment/</a></u></p><h4 id="iis-server-setup-one-time-only">IIS server setup (one-time-only!)</h4><p>That said: if this is your first time setting up a .NET 5 site in IIS, you must install the .NET 5 IIS module. Download and install the &#x201C;Hosting Bundle&#x201D; from: <u><a href="https://dotnet.microsoft.com/download/dotnet/5.0">https://dotnet.microsoft.com/download/dotnet/5.0</a></u></p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/02/iis-hosting-bundle-2.png" class="kg-image" alt="Running with Foundation" loading="lazy" width="516" height="302"></figure><h4 id="get-the-code">Get the code</h4><p>Download the code from the GitHub repository. (Note: several options to complete this step are presented below, depending on your familiarity with Git. Or you can skip past this step because you already know how to do it. It&apos;s your world, I&apos;m just living in it.)</p><p>In all cases, I&apos;m assuming the root of the repo is in the folder <em>\foundation.</em></p><h5 id="option-1-download-the-main-branch-from-the-repository-as-a-zip-file">Option 1: download the main branch from the repository as a ZIP file</h5><ol><li>Open the repo in your web browser:</li><li>Change to the &#x201C;<em>main</em>&#x201D; branch</li><li>Click the &#x201C;Code&#x201D; button, and select &#x201C;Download ZIP&#x201D;</li><li>After the file has downloaded, right click and select &#x201C;Properties&#x201D;. Check the &#x201C;Unblock&#x201D; box and click OK.</li><li>Unzip the file to a folder</li></ol><h5 id="option-2-command-line-clone-the-repository-and-then-checkout-the-main-branch">Option 2: command line! Clone the repository and then checkout the main branch</h5><ol><li>Clone the repo:<br><em>git clone https://github.com/episerver/foundation.git</em></li><li>Go into the &#x201C;foundation&#x201D; directory where you cloned the repo</li><li>Check out the main branch:<br><em>git checkout main</em></li></ol><h5 id="option-3-more-command-line-clone-checkout-the-main-branch-in-one-step">Option 3: more command line! Clone + checkout the main branch in one step</h5><ol><li>Clone and checkout the <em>main </em>branch:<br><em>git clone -b main https://github.com/episerver/foundation.git</em></li></ol><h4 id="update-appsettingsjson">Update appsettings.json</h4><p>Remember earlier when I wrote about adding a Find (search) index to the <em>appsettings.json</em>? Do that. It might save some headaches (search is pretty integral to the Foundation site).</p><h4 id="have-a-license">Have a license?</h4><p>If you have a license (in the form of a <em>License.config</em> file), copy it to the site directory:<br>	<em>\foundation\src\Foundation\</em> </p><p>Note: a license file isn&#x2019;t needed for running under localhost. You might be able to sign up for a demo license at <a href="https://license.episerver.com/">https://license.episerver.com/</a>.</p><h4 id="run-the-setup">Run the setup</h4><p>Return to the root folder and run the <em>setup.cmd</em> script as an administrator &#x2013; this will create and configure the database, and some other initial setup. (Note, the &#x201C;app name&#x201D; property will just be used in the database names &#x2013; it will not create an IIS site during this process.)</p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/02/code-setup.jpg" class="kg-image" alt="Running with Foundation" loading="lazy" width="640" height="427" srcset="https://blog.danisaacs.net/content/images/size/w600/2022/02/code-setup.jpg 600w, https://blog.danisaacs.net/content/images/2022/02/code-setup.jpg 640w"></figure><h4 id="publish-the-site">Publish the site</h4><p>First, create a publish folder -- I created it in the root repository folder (<em>\foundation</em>) and called it &#x201C;publish&#x201D;, so it had the following path:</p><p><em>	\foundation\publish</em></p><p><br>Now, open a command line (I like Powershell, myself).</p><ol><li>Switch to the site root directory: <em>c:\whatever\your\path\is\foundation</em></li><li>Publish to the directory you just created (this example assumes the path I used; adjust the path to your publish folder as needed):</li></ol><p><em>	dotnet publish -c Debug -o .\publish /p:EnvironmentName=Development</em></p><p><br>(Once you have your site up and running, subsequent publishes can be tricky &#x2013; I&apos;m going to include some notes at the bottom of this article around that, but for now this should be all you need.)</p><h4 id="set-up-the-site-in-iis">Set up the site in IIS</h4><p>We&apos;re almost there! (Note to self (left publicly to remind me later): maybe this should be scripted and included as an optional step in the setup?) Until then &#x2013; open up IIS.</p><ol><li>Create a new site (right click &quot;Sites&quot; and select &quot;Add Website&#x2026;&quot;)</li><li>Site name: foundation-net5 [you can use anything you want here]</li><li>Physical path: full path to the &#x201C;publish&#x201D; folder created in the earlier step</li><li>Host name: the url you want to use to access the site.<br><br>Fun tip: if you&#x2019;re just interested in setting the site up in IIS but don&#x2019;t need to access it externally --<br><br>If you use the domain &quot;mysite.localmachine.name&quot; (substituting anything for &quot;mysite&quot;), you can set it up locally in IIS without needing to update your hosts file. For example, I used foundation-net5.localmachine.name. (For more info -- <a href="https://www.david-tec.com/2013/07/Never-edit-your-hosts-file-again-when-working-on-localhost/" rel="noreferrer noopener">https://www.david-tec.com/2013/07/Never-edit-your-hosts-file-again-when-working-on-localhost/</a> -- thanks, David!)</li></ol><p>When you created the site, it will have automatically created an app pool. You&apos;re going to need to update the Application Pool settings to avoid errors with OpenIDConnect:</p><p>Right click the Application Pool created when you created the site in the previous step (by default, it should have the same name as the site), and select &#x201C;Advanced Settings&#x201D;</p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/02/app-pool-setup-01-e.png" class="kg-image" alt="Running with Foundation" loading="lazy" width="324" height="188"></figure><p>Find the &#x201C;Identity&#x201D; setting, and click the dots to open the menu to change the setting</p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/02/app-pool-setup-02-e.png" class="kg-image" alt="Running with Foundation" loading="lazy" width="505" height="85"></figure><p>Change the setting to &#x201C;LocalSystem&#x201D;, and click OK</p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/02/app-pool-setup-03-e.png" class="kg-image" alt="Running with Foundation" loading="lazy" width="392" height="234"></figure><h4 id="thats-it">That&apos;s it!</h4><p>You should be all set &#x2013; open your browser, and try to access the site at the domain you added when setting up the site in IIS.</p><h3 id="troubleshooting">Troubleshooting</h3><h5 id="windowscryptographicexception">WindowsCryptographicException</h5><p>Get a &#x201C;WindowsCryptographicException&#x201D; when you try to load the site? Double check that you updated the AppPool settings to use LocalSystem identity.</p><h5 id="get-a-syntax-error-while-assets-are-built">Get a syntax error while assets are built?</h5><!--kg-card-begin: markdown--><p><sub>[webpack-cli] <span style="color:red">SyntaxError: Invalid regular expression: /(\p{Uppercase_Letter}+|\p{Lowercase_Letter}|\d)(\p{Uppercase_Letter}+)/: Invalid escape</span></sub></p>
<!--kg-card-end: markdown--><p><br>Make sure you&apos;re on a recent version of Node.</p><h5 id="dont-see-anything">Don&apos;t see anything?</h5><p>Make sure your monitor is on.</p><h3 id="more-tips">More tips!</h3><h4 id="publishing-site-changes-while-running-under-iis">Publishing site changes while running under IIS</h4><p>After the site is running under IIS, for subsequent publish commands you need to stop the site&#x2019;s application pool before publishing. Otherwise, the files are locked by the app pool, and it will not deploy correctly.</p><p>To avoid this issue, you can manually add a file called &#x201C;app_offline.htm&#x201D; to the publish directory before publishing &#x2013; this tells IIS to release the files.</p><p>To automate this process: create a Powershell script called &quot;<em>publish.ps1</em>&quot; and put it in the root <em>/foundation</em> folder. Add the following lines to the file:</p><pre><code class="language-powershell">$pathToApp = &apos;.\publish&apos; 
New-Item -Path $pathToApp -Name &quot;app_offline.htm&quot; -ItemType &quot;file&quot; 
dotnet publish -c Debug -o $pathToApp /p:EnvironmentName=Development 
Remove-Item -Path $pathToApp\app_offline.htm </code></pre><p>Adjust the path in the first line as needed, based on your publish folder location. Run this script from Powershell via the command &#x201C;<em>.\publish.ps1</em>&#x201D; whenever you want to publish the site, instead of just the standard <em>dotnet publish</em> command we used earlier.</p><h4 id="changing-the-port-when-running-under-localhost">Changing the port when running under localhost </h4><p>Want to change the port the site runs on locally? Update the &#x201C;applicationUrl&#x201D; setting in the launchSettings.json file (<em>\src\Foundation\Properties\launchSettings.json</em>) </p><p><br>For example, to use port 8000, change that line to: </p><p>	<em>&quot;applicationUrl&quot;: &quot;https://localhost:8001;http://localhost:8000&quot; </em></p><h2 id="conclusions">Conclusions</h2><p>Hopefully this (much longer than I meant to) post will help you get the .NET 5 version of Foundation up and running locally. Have any questions? Feel free to reach out. Find an issue? Create an issue in the GitHub repo. Wish this article had more fun images? Me too friend, me too.</p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/02/foundation-on-linux.png" class="kg-image" alt="Running with Foundation" loading="lazy" width="1503" height="691" srcset="https://blog.danisaacs.net/content/images/size/w600/2022/02/foundation-on-linux.png 600w, https://blog.danisaacs.net/content/images/size/w1000/2022/02/foundation-on-linux.png 1000w, https://blog.danisaacs.net/content/images/2022/02/foundation-on-linux.png 1503w" sizes="(min-width: 720px) 720px"></figure>]]></content:encoded></item><item><title><![CDATA[Optimizely Data Platform (ODP) - Tracking and Usage Examples]]></title><description><![CDATA[Getting started with Optimizely Data Platform -- Some example tracking and usage of ODP]]></description><link>https://blog.danisaacs.net/optimizely-data-platform-odp-tracking-and-usage-examples/</link><guid isPermaLink="false">61e0d9673c7ec60001079567</guid><category><![CDATA[optimizely]]></category><category><![CDATA[odp]]></category><category><![CDATA[optimizely data platform]]></category><dc:creator><![CDATA[Dan Isaacs]]></dc:creator><pubDate>Fri, 14 Jan 2022 02:30:44 GMT</pubDate><media:content url="https://blog.danisaacs.net/content/images/2022/01/odp-2.png" medium="image"/><content:encoded><![CDATA[<img src="https://blog.danisaacs.net/content/images/2022/01/odp-2.png" alt="Optimizely Data Platform (ODP) - Tracking and Usage Examples"><p>The goal of this post is to provide some examples of working with <a href="https://www.optimizely.com/products/intelligence/data-platform/">Optimizely Data Platform (ODP)</a> with <a href="https://www.optimizely.com/products/content/">Optimizely Content Cloud</a> and <a href="https://www.optimizely.com/products/commerce/b2c/">Commerce Cloud</a>. Note that, while focused on those platforms using our <a href="https://github.com/episerver/Foundation">Foundation reference implementation</a>, the overall strategies can be used for tracking on any solution.</p><p>Rather than recreate the wheel, for a great starting point please reference David Knipe&apos;s blog post <a href="https://www.david-tec.com/2021/05/adding-optimizely-data-platform-to-optimizely-commerce-cloud/">&quot;Adding Optimizely Data Platform to Optimizely Commerce Cloud&quot;</a>. It provides a very solid base on which to build, and allows us to go straight into other tracking examples and how you might use the data in ODP itself. One key step from that blog post you must complete is to add the standard JavaScript tracking script for ODP to your site, to enable pageview and customer tracking. The script can be found by going to the ODP &quot;Integrations&quot; admin screen, and clicking into the &quot;JavaScript Tag&quot; integration -- refer to the <a href="https://docs.zaius.com/hc/en-us/articles/360033327194-Install-the-Zaius-JavaScript-tag">ODP JavaScript tag documentation here</a> for more details.</p><p>Now, let&apos;s get into some custom event tracking.</p><h2 id="optimizely-forms-events">Optimizely Forms Events</h2><h3 id="odp-prep">ODP Prep</h3><p>First you&apos;ll need to create a new field in ODP. Log in to ODP, then go to account settings by clicking the gear icon in the top-right of the page.</p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/01/adding_field-01.png" class="kg-image" alt="Optimizely Data Platform (ODP) - Tracking and Usage Examples" loading="lazy" width="224" height="101"></figure><p>Then select &quot;Create New Field&quot; to create the new property -- I used the following values (the &quot;field name&quot; will be used in the tracking section below):</p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/01/adding_field-02.png" class="kg-image" alt="Optimizely Data Platform (ODP) - Tracking and Usage Examples" loading="lazy" width="564" height="89"></figure><h3 id="tracking">Tracking</h3><p>The example tracking below for Optimizely Forms leverages the available <a href="https://world.optimizely.com/documentation/developer-guides/forms/handling-events-for-forms/">Forms client-side events</a> to track form impressions and form submissions. Alternatively, form submission tracking could be done server-side by modifying it to use the .NET events documented on that page.</p><pre><code class="language-javascript">// ODP Tracking for Optimizely Forms

if (typeof $$epiforms !== &apos;undefined&apos;) {
    $$epiforms(document).ready(function myfunction() {
        $$epiforms(&quot;.EPiServerForms&quot;).on(&quot;formsNavigationNextStep formsNavigationPrevStep formsSetupCompleted formsReset formsStartSubmitting formsSubmitted formsSubmittedError formsNavigateToStep formsStepValidating&quot;,
            function (event, param1, param2) {
                var eventType = event.type;
                var formName = event.workingFormInfo.Name;

                if (eventType == &apos;formsSetupCompleted&apos;) {
                    console.log(&apos;ODP: web_form impression: &apos; + formName);
                    zaius.event(&apos;web_form&apos;, { action: &apos;impression&apos;, form_name: formName });
                } else if (eventType == &apos;formsStepValidating&apos;) {
                    if (!event.isValid) {
                        console.log(&apos;ODP: web_form validation failed: &apos; + formName);
                        zaius.event(&apos;web_form&apos;, { action: &apos;submission_validation_failed&apos;, form_name: formName });
                    }
                } else if (eventType == &apos;formsSubmitted&apos;) {
                    console.log(&apos;ODP: web_form submission: &apos; + formName);
                    zaius.event(&apos;web_form&apos;, { action: &apos;submission&apos;, form_name: formName });
                } else {
                    // handle other form events here
                }
            });
    });
}</code></pre><p>Once that script is included on your site, then viewing a page with an Optimizely Form will trigger a &quot;Web Form: Impression&quot; event, and submitting a form will trigger a &quot;Web Form: Submission&quot; event:</p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/01/form-events-impression-and-submission-v2.png" class="kg-image" alt="Optimizely Data Platform (ODP) - Tracking and Usage Examples" loading="lazy" width="706" height="94" srcset="https://blog.danisaacs.net/content/images/size/w600/2022/01/form-events-impression-and-submission-v2.png 600w, https://blog.danisaacs.net/content/images/2022/01/form-events-impression-and-submission-v2.png 706w"></figure><h3 id="usage-in-odp">Usage in ODP</h3><p>Once you&apos;re tracking those form events, you can start to put them to work for you. Some simple suggestions:</p><ul><li>Build a report in ODP to track overall form conversion rates (impressions vs submissions)</li><li>Build a report in ODP to track form conversion rates for a specific form across multiple pages -- which page has more success?</li><li>Build a segment of visitors that saw the form, but didn&apos;t submit it -- convert that to a Facebook lookalike audience, and target them in an ad campaign</li></ul><p>Let&apos;s walk through the steps for the first example -- a report to track form conversion rates:</p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/01/forms-report-conversion-rate-by-form.png" class="kg-image" alt="Optimizely Data Platform (ODP) - Tracking and Usage Examples" loading="lazy" width="1106" height="263" srcset="https://blog.danisaacs.net/content/images/size/w600/2022/01/forms-report-conversion-rate-by-form.png 600w, https://blog.danisaacs.net/content/images/size/w1000/2022/01/forms-report-conversion-rate-by-form.png 1000w, https://blog.danisaacs.net/content/images/2022/01/forms-report-conversion-rate-by-form.png 1106w" sizes="(min-width: 720px) 720px"></figure><ol><li>First, create a filter -- Event Type = &quot;web_form&quot; and Form Name is not empty</li></ol><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/01/form-events-filter.png" class="kg-image" alt="Optimizely Data Platform (ODP) - Tracking and Usage Examples" loading="lazy" width="542" height="383"></figure><p>2. Create a new report. Apply your new filter by clicking &quot;All Traffic&quot; in the top-left, and selecting your filter. Click the checkbox to apply:</p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/01/form-events-apply-filter.png" class="kg-image" alt="Optimizely Data Platform (ODP) - Tracking and Usage Examples" loading="lazy" width="347" height="114"></figure><p>3. Add columns to your report -- in this example, I added the field &quot;Form Name&quot;, and then the following rocket columns to get the count of impressions, submissions and the calculated conversion rate:</p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/01/forms-report-conversion-rate-by-form-rocket-columns.png" class="kg-image" alt="Optimizely Data Platform (ODP) - Tracking and Usage Examples" loading="lazy" width="832" height="210" srcset="https://blog.danisaacs.net/content/images/size/w600/2022/01/forms-report-conversion-rate-by-form-rocket-columns.png 600w, https://blog.danisaacs.net/content/images/2022/01/forms-report-conversion-rate-by-form-rocket-columns.png 832w" sizes="(min-width: 720px) 720px"></figure><p>Bonus: want to track an individual form, and see its success rate across different pages? Follow the steps above, and then:</p><ol><li>Use the &quot;Simple Filter&quot; option to specify the form by name (don&apos;t forget to click &quot;Apply&quot; after adding the simple filter!)</li></ol><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/01/forms-report-conversion-rate-by-form-quick-filter.png" class="kg-image" alt="Optimizely Data Platform (ODP) - Tracking and Usage Examples" loading="lazy" width="643" height="185" srcset="https://blog.danisaacs.net/content/images/size/w600/2022/01/forms-report-conversion-rate-by-form-quick-filter.png 600w, https://blog.danisaacs.net/content/images/2022/01/forms-report-conversion-rate-by-form-quick-filter.png 643w"></figure><p>2. Add the Page to the report columns.</p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/01/forms-report-conversion-rate-by-page.png" class="kg-image" alt="Optimizely Data Platform (ODP) - Tracking and Usage Examples" loading="lazy" width="1026" height="230" srcset="https://blog.danisaacs.net/content/images/size/w600/2022/01/forms-report-conversion-rate-by-page.png 600w, https://blog.danisaacs.net/content/images/size/w1000/2022/01/forms-report-conversion-rate-by-page.png 1000w, https://blog.danisaacs.net/content/images/2022/01/forms-report-conversion-rate-by-page.png 1026w" sizes="(min-width: 720px) 720px"></figure><h2 id="search-events">Search Events</h2><p>Note: the example tracking below is specific to the <a href="https://github.com/episerver/foundation">Foundation reference site</a>, but the principles will apply and can easily be modified to fit any search implementation.</p><h3 id="odp-prep-1">ODP Prep</h3><p>First, create a new field for the search term -- the scripts below use the field name &quot;search_term&quot;, type &quot;text&quot;.</p><h3 id="tracking-1">Tracking</h3><p>I&apos;ve included three types of tracking below: the initial search event, searches with no results, and search result click tracking.</p><h4 id="initial-search-event">Initial Search Event</h4><pre><code class="language-javascript">// Enter for search
$(document).keypress(function(event){
    var key = event.which;
    if(key == 13)  // the enter key code
    {
        var searchValue = null;
        var searchInputs = $(&apos;.jsSearchText&apos;);
        if (searchInputs != null)
        {
            for (var i = 0; i &lt; searchInputs.length; i++)
            {
                var input = searchInputs[i];
                if (input.value != null &amp;&amp; input.value != &apos;&apos;)
                {
                    searchValue = input.value;
                    console.log(&apos;ODP: search: &apos; + searchValue);
                    zaius.event(&apos;navigation&apos;, { action: &apos;search&apos;, search_term: searchValue });
                }
            }
        }
    }
});</code></pre><h4 id="no-results-and-search-result-click-tracking">&quot;No Results&quot; and Search Result Click Tracking</h4><p>This script tracks searches that have no results, and also tracks search result clicks (breaking them up between clicks on content results versus product search results).</p><pre><code>$(document).ready(function() {
	var searchValue = null;
	const params = new URLSearchParams(window.location.search);
	searchValue = params.get(&apos;search&apos;);
		 
	if (document.querySelector(&apos;.content-search-results&apos;) == null &amp;&amp; document.querySelector(&apos;.product-tile-grid&apos;) == null) 
	{
		 console.log(&quot;ODP: Track no search results&quot;)
		 zaius.event(&apos;search&apos;, { action: &apos;no_results&apos; , search_term: searchValue });
	}
	
	$(&apos;.content-search-results &gt; a&apos;).click(function() {
		let clickedLink = $(this).attr(&quot;href&quot;);
		console.log(&quot;ODP: Track search result link click -- &quot; + clickedLink + &quot; (search term: &quot; + searchValue + &quot;)&quot;);
		zaius.event(&apos;search&apos;, { action: &apos;click&apos; , search_term: searchValue, search_clicked_content: clickedLink });
	});

	$(&apos;.product-tile-grid&apos;).click(function() {
		let site = location.protocol + &apos;//&apos; + location.host;
		let clickedProd = $(this).children(&apos;.product-tile-grid__title&apos;).children(&apos;a&apos;).attr(&quot;href&quot;);
		let clickedProdLink  = site + clickedProd;
		console.log(&quot;ODP: Track search result product click -- &quot; + clickedProdLink + &quot; (search term: &quot; + searchValue + &quot;)&quot;);
		zaius.event(&apos;search&apos;, { action: &apos;click&apos; , search_term: searchValue, search_clicked_product: clickedProdLink });
	});
});</code></pre><h3 id="usage-in-odp-1">Usage in ODP</h3><p>Search event tracking can be used in a variety of ways. A few quick examples include:</p><ul><li>Top searches</li><li>Top searches without results</li><li>Clickthrough rate for search results</li></ul><p>Build reports in ODP to identify popular searches and searches without results to help drive content creation. Create <a href="https://webhelp.optimizely.com/latest/en/searchnavigation/best-bets.htm">Best Bets</a> in Optimizely Search &amp; Navigation to address searches without results. Build segments to target visitors searching for specific search terms.</p><h2 id="video-events">Video Events</h2><p>Just for fun, a rough implementation of tracking of YouTube video events. Identify users that loaded a video, and track their progress through it. Then use that data to identify popular (or unpopular) videos, or target visitors that stopped a certain video before completion, or visitors that are interested in certain types of videos.</p><h3 id="odp-prep-2">ODP Prep</h3><p>For this example I added three new fields to ODP:</p><ul><li>video_id_yt (YouTube video ID) (type: Text)</li><li>video_play_percentage (type: Number)</li><li>video_title (type: Text)</li></ul><h3 id="video-event-tracking">Video Event Tracking</h3><p>The following script will track YouTube video events, including video loads, video plays, video progress (10%, 25%, 50%, 75%, 90%, and completed), and pauses/restarts. It leverages the <a href="https://developers.google.com/youtube/iframe_api_reference">YouTube API for iframe embeds</a>.</p><p>A couple caveats: the script as-is will only track if there is a single YouTube video block on the page, because it targets the video based on the id=&quot;youtube-block&quot; attribute when the block is rendered.</p><pre><code class="language-javascript">var tag = document.createElement(&apos;script&apos;);
tag.id = &apos;youtube-iframe&apos;;
tag.src = &apos;https://www.youtube.com/iframe_api&apos;;
var firstScriptTag = document.getElementsByTagName(&apos;script&apos;)[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

var player;
function onYouTubeIframeAPIReady() {
    player = new YT.Player(&apos;youtube-block&apos;, {
        events: {
            &apos;onReady&apos;: onPlayerReady,
            &apos;onStateChange&apos;: onPlayerStateChange
        }
    });
}

var sendEvents = true;

var videoDuration;
var videoId;
var videoTitle;
var timer;
var currentProgress = 0;
var previousProgress = 0;
var progressEventPoints = [10, 25, 50, 75, 90];


var startedPlay = false;
var pausedPlay = false;
var halfway = false;

function writeLoadVideoEvent() {
    console.log(&quot;ODP - video loaded - &quot; + videoTitle);
    if (sendEvents) {
        zaius.event(&quot;video&quot;, {
            action: &quot;loaded&quot;,
            video_id_yt: videoId,
            video_title: videoTitle,
            video_play_percentage: 0,
            video_action: true
        });
    }
}

function writeStartVideoEvent() {
    console.log(&quot;ODP - video started&quot;);
    if (sendEvents) {
        zaius.event(&quot;video&quot;, {
            action: &quot;started&quot;,
            video_id_yt: videoId,
            video_title: videoTitle,
            video_play_percentage: 0,
            video_action: true
        });
    }
}

function writeHalfVideoEvent() {
    console.log(&quot;ODP - video 50% completed&quot;);
    if (sendEvents) {
        zaius.event(&quot;video&quot;, {
            action: &quot;watched_half&quot;,
            video_id_yt: videoId,
            video_title: videoTitle,
            video_play_percentage: 50,
            video_action: true
        });
    }
}

function writeEndVideoEvent() {
    console.log(&quot;ODP - video completed&quot;);
    if (sendEvents) {
        zaius.event(&quot;video&quot;, {
            action: &quot;watched&quot;,
            video_id_yt: videoId,
            video_title: videoTitle,
            video_play_percentage: 100,
            video_action: true
        });
    }
}

function writeVideoProgressEvent(percent) {
    console.log(&quot;ODP - video &quot; + percent + &quot;% completed&quot;);
    if (sendEvents) {
        zaius.event(&quot;video&quot;, {
            action: &quot;video_progress&quot;,
            video_id_yt: videoId,
            video_title: videoTitle,
            video_play_percentage: percent,
            video_action: true
        });
    }
}

function writePauseVideoEvent(percent) {
    console.log(&quot;ODP - video paused &quot; + percent + &quot;%&quot;);
    if (sendEvents) {
        zaius.event(&quot;video&quot;, {
            action: &quot;paused&quot;,
            video_id_yt: videoId,
            video_title: videoTitle,
            video_play_percentage: percent,
            video_action: true
        });
    }
}

function writeRestartVideoEvent(percent) {
    console.log(&quot;ODP - video restarted at &quot; + percent + &quot;%&quot;);
    if (sendEvents) {
        zaius.event(&quot;video&quot;, {
            action: &quot;restarted&quot;,
            video_id_yt: videoId,
            video_title: videoTitle,
            video_play_percentage: percent,
            video_action: true
        });
    }
}

function onPlayerReady(event) {
    videoDuration = player.getDuration();
    videoId = player.getVideoData().video_id;
    videoTitle = player.getVideoData().title;
    writeLoadVideoEvent();
}

function play_progress_reached() {
    current_time = player.getCurrentTime();
    currentProgress = parseInt((current_time / videoDuration) * 100);
    if (player.getPlayerState() == YT.PlayerState.PLAYING) {
        if (startedPlay == false) {
            writeStartVideoEvent();
            startedPlay = true;
        } else if (pausedPlay == true) {
            writeRestartVideoEvent(currentProgress);
            pausedPlay = false;
        } else if (currentProgress &gt; 0 &amp;&amp; currentProgress % 5 == 0 &amp;&amp; currentProgress &gt; previousProgress) {
            if (currentProgress &gt; previousProgress &amp;&amp; progressEventPoints.includes(currentProgress)) {
                writeVideoProgressEvent(currentProgress);
                previousProgress = currentProgress;
            }
        }
    } else if (player.getPlayerState() == YT.PlayerState.PAUSED) {
        writePauseVideoEvent(currentProgress);
        pausedPlay = true;
        clearInterval(timer);
    } else if (player.getPlayerState() == YT.PlayerState.ENDED) {
        writeEndVideoEvent();
        clearInterval(timer);
    } else {
        clearInterval(timer);
    }
}

function play_progress_callback() {
    clearInterval(timer);
    current_time = player.getCurrentTime();
    currentProgress = parseInt((current_time / videoDuration) * 100);
    remaining_time = videoDuration - current_time;
    if (remaining_time &gt; 0) {
        timer = setInterval(play_progress_reached, 500);
    }
}

function onPlayerStateChange(event) {
    if (event.data == YT.PlayerState.PLAYING) {
        console.log(&quot;Video playing&quot;);
    }
    clearInterval(timer);
    play_progress_callback();
}</code></pre><p>Usage in ODP</p><p>Use the tracked events to identify which videos are getting watched (and watched to completion), versus videos that aren&apos;t getting any plays at all or are frequently stopped before the end.</p><p>Here&apos;s a sample report, as a starting point:</p><figure class="kg-card kg-image-card"><img src="https://blog.danisaacs.net/content/images/2022/01/video-events-report.png" class="kg-image" alt="Optimizely Data Platform (ODP) - Tracking and Usage Examples" loading="lazy" width="1868" height="454" srcset="https://blog.danisaacs.net/content/images/size/w600/2022/01/video-events-report.png 600w, https://blog.danisaacs.net/content/images/size/w1000/2022/01/video-events-report.png 1000w, https://blog.danisaacs.net/content/images/size/w1600/2022/01/video-events-report.png 1600w, https://blog.danisaacs.net/content/images/2022/01/video-events-report.png 1868w" sizes="(min-width: 720px) 720px"></figure><h2 id="conclusions">Conclusions</h2><p>Optimizely Data Platform (ODP) provides your team with the flexibility to track any custom events for both known and unknown visitors, and use that information to build reports and create targeted campaigns to increase engagement with your visitors.</p><p>A few additional references for working with ODP:</p><ul><li>Using ODP with Commerce Cloud: <a href="https://www.david-tec.com/2021/05/adding-optimizely-data-platform-to-optimizely-commerce-cloud/">https://www.david-tec.com/2021/05/adding-optimizely-data-platform-to-optimizely-commerce-cloud/</a></li><li>ODP reference guide: <a href="https://world.optimizely.com/blogs/K-Khan-/Dates/2021/6/odp-handy-reference-guide---web-sdk/">https://world.optimizely.com/blogs/K-Khan-/Dates/2021/6/odp-handy-reference-guide---web-sdk/</a></li><li>ODP documentation: <a href="https://docs.zaius.com/">https://docs.zaius.com/</a></li><li>ODP developer documentation: <a href="https://docs.developers.zaius.com/">https://docs.developers.zaius.com/</a></li></ul>]]></content:encoded></item></channel></rss>